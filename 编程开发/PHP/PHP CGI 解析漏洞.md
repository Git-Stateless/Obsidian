# PHP CGI 解析漏洞

## CGI 简介

CGI（Conmon Gateway Interface，通用网关接口）是一种规范，而并不是一种语言。Web服务器接收到用户请求，并把请求提交给CGI程序；CGI程序会根据请求提交的参数作相应处理，然后输出标准的HTML语句返回给Web服务器；Web服务器再返回给客户端。这就是CGI的工作原理，CGI实现了动态网页的供能。

## fastcgi 简介

CGI的特点是：每收到一个请求，Web服务器都要派生（fork）出一个单独的CGI程序的进程来处理。这种方式好处是使Web服务器和具体的程序处理相互独立，结构清晰，可控性强；但是，如果在高访问量的情况下，CGI的进程派生就会成为服务器的很大负担。
fastcgi是基于CGI架构的扩展，它的核心思想就是在Web服务器和具体CGI程序之间建立一个智能的可持续的中间层，统一管理CGI程序的运行。这样Web服务器只需要将请求提交给这个中间层，这个中间层再派生几个可复用的CGI实例，然后再把请求分发给这些实例。这些实例是可控的、可持续的、可复用的，因此一方面避免了进程的反复派生，另一方面可以通过中间层的控制和探测机制来监视这些实例的运行情况，根据不同的状况派生或者回收实例，达到灵活性和稳定性兼顾的目的。

## PGP-CGI 解析漏洞

PHP的配置文件中有一个参数是 cgi.fix_pathinfo，如果设置了 cgi.fix_pathinfo=1，则在访问http://ctfs-wiki.com/x.jpg/x.php 时，如果 x.php 不存在，PHP会递归向前解析，如果x.jpg存在，就会把x.jpg当作PHP文件解析，这样就产生了解析漏洞。